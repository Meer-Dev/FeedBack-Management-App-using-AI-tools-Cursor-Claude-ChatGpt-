<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">
        <div class="d-flex flex-column-fluid">
            <div class="container">
                <div class="card card-custom">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">
                                <i class="flaticon2-chat-1 text-primary"></i>
                            </span>
                            <h3 class="card-label">{{ 'Feedbacks' | localize }}</h3>
                        </div>
                        <div class="card-toolbar">
                            <button
                                *ngIf="isGranted('Pages.Feedbacks')"
                                (click)="createFeedback()"
                                class="btn btn-primary">
                                <i class="fa fa-plus"></i>
                                {{ 'CreateNewFeedback' | localize }}
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-5">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <div class="input-icon">
                                        <input
                                            [(ngModel)]="keyword"
                                            (keyup.enter)="list()"
                                            type="text"
                                            class="form-control"
                                            placeholder="{{ 'SearchWithThreeDot' | localize }}"
                                        />
                                        <span><i class="flaticon2-search-1 text-muted"></i></span>
                                    </div>
                                </div>
                                <div class="col-md-6 text-right">
                                    <button
                                        (click)="clearFilters()"
                                        class="btn btn-light-primary px-5 font-weight-bold">
                                        {{ 'Clear' | localize }}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-5">
                            <div class="row">
                                <div class="col-md-3">
                                    <label class="form-label">{{ 'Course' | localize }}</label>
                                    <select
                                        [(ngModel)]="courseId"
                                        (change)="list()"
                                        class="form-control">
                                        <option [ngValue]="null">{{ 'All' | localize }}</option>
                                        <option *ngFor="let course of courses" [ngValue]="course.id">
                                            {{ course.courseName }}
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">{{ 'MinRating' | localize }}</label>
                                    <input
                                        type="number"
                                        [(ngModel)]="minRating"
                                        (change)="list()"
                                        class="form-control"
                                        min="1"
                                        max="5"
                                    />
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">{{ 'MaxRating' | localize }}</label>
                                    <input
                                        type="number"
                                        [(ngModel)]="maxRating"
                                        (change)="list()"
                                        class="form-control"
                                        min="1"
                                        max="5"
                                    />
                                </div>
                            </div>
                        </div>

                        <p-table
                            #dataTable
                            sortMode="multiple"
                            (onLazyLoad)="list($event)"
                            [value]="primengTableHelper.records"
                            rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                            [paginator]="false"
                            [lazy]="true"
                            [loading]="primengTableHelper.isLoading"
                            [totalRecords]="primengTableHelper.totalRecordsCount"
                            styleClass="p-datatable-gridlines">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 150px" pSortableColumn="studentName">
                                        {{ 'StudentName' | localize }}
                                        <p-sortIcon field="studentName"></p-sortIcon>
                                    </th>
                                    <th style="width: 200px" pSortableColumn="courseName">
                                        {{ 'Course' | localize }}
                                        <p-sortIcon field="courseName"></p-sortIcon>
                                    </th>
                                    <th style="width: 100px" pSortableColumn="rating">
                                        {{ 'Rating' | localize }}
                                        <p-sortIcon field="rating"></p-sortIcon>
                                    </th>
                                    <th style="width: 300px">{{ 'Comment' | localize }}</th>
                                    <th style="width: 150px" pSortableColumn="createdDate">
                                        {{ 'CreatedDate' | localize }}
                                        <p-sortIcon field="createdDate"></p-sortIcon>
                                    </th>
                                    <th style="width: 100px">{{ 'File' | localize }}</th>
                                    <th style="width: 100px">{{ 'Actions' | localize }}</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-record>
                                <tr>
                                    <td>{{ record.studentName }}</td>
                                    <td>{{ record.courseName }}</td>
                                    <td>
                                        <span class="badge badge-info">{{ record.rating }}/5</span>
                                    </td>
                                    <td>{{ record.comment }}</td>
                                    <td>{{ record.createdDate | date: 'short' }}</td>
                                    <td>
                                        <button
                                            *ngIf="record.fileUrl"
                                            (click)="downloadFile(record.fileUrl)"
                                            class="btn btn-sm btn-info">
                                            <i class="fa fa-download"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button
                                            *ngIf="isGranted('Pages.Feedbacks')"
                                            (click)="editFeedback(record)"
                                            class="btn btn-sm btn-primary">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                        <button
                                            *ngIf="isGranted('Pages.Feedbacks')"
                                            (click)="delete(record)"
                                            class="btn btn-sm btn-danger">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                            {{ 'NoData' | localize }}
                        </div>
                        <div class="primeng-paging-container">
                            <p-paginator
                                [rows]="primengTableHelper.defaultRecordsCountPerPage"
                                #paginator
                                (onPageChange)="list($event)"
                                [totalRecords]="primengTableHelper.totalRecordsCount"
                                [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
                            </p-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

